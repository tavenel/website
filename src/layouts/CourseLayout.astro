---
import BaseLayout from '@layouts/BaseLayout.astro';
import Diagrams from '@components/Diagrams.astro';

import { GIT_FILE_TREE_PAGES } from '../constants.ts';

import type { MarkdownLayoutProps } from 'astro';
type Props = MarkdownLayoutProps<{
	// Define frontmatter props here
	title: string;
	date: string;
	created: string;
	lastModified: string;
	checked: string;
	extra: string[];
}>;

// Now, `frontmatter`, `url`, and other Markdown layout properties
// are accessible with type safety
const { frontmatter, url } = Astro.props;
const initialDate = frontmatter.created ? new Date(frontmatter.created).toLocaleDateString() : '?';
const lastModified = frontmatter.lastModified ? new Date(frontmatter.lastModified).toLocaleDateString() : '?';
const checkedDate = frontmatter.checked ? new Date(frontmatter.checked).toLocaleDateString() : '?';
const markdownPath = new URL(GIT_FILE_TREE_PAGES + url + '.md');
---
<BaseLayout title={frontmatter.title} url={url}>
	<h1>{frontmatter.title}</h1>
	<div class="versioning">
		{frontmatter.date && <div class="version-first">Date : {frontmatter.date}</div>}
		{frontmatter.created && <div class="version-first">Publié le : {initialDate}</div>}
		{frontmatter.lastModified && <div class="version-update">Mis à jour : {lastModified}</div>}
		{frontmatter.checked && <div class="version-checked">Contenu vérifé le : {checkedDate}</div>}
		<div class="source-markdown"><a href={markdownPath}>Fichier source (Markdown)</a></div>
	</div>
	<slot />
	<Diagrams
		math={ frontmatter.extra?.includes('math') }
		markmap={ frontmatter.extra?.includes('markmap') }
		mermaid={ frontmatter.extra?.includes('mermaid') }
	/>
</BaseLayout>
