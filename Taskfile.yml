# A https://taskfile.dev (similar to Makefile)
version: "3"

tasks:
  full-build:
    deps: [build, licenses]

  serve:
    # serve in container on <http://localhost:8080>
    cmds:
      - docker run --rm --name astro-webserver -d -v "${PWD}/dist:/usr/share/nginx/html" -p 8080:80 nginx

  serve-stop:
    cmds:
      - docker container stop astro-webserver

  dev:
    cmds:
      - bun run dev

  build:
    cmds:
      - bun run build

  licenses:
    cmds:
      - cp .LICENSE.main LICENSE
      - bun run licenses generate-disclaimer >> LICENSE
      - bun run licenses list >> LICENSE

  upgrade:
    cmds:
      - npx @astrojs/upgrade
      - task: build
      - task: licenses
